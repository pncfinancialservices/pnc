(function(c,q){c.Granite=c.Granite||{};c.Granite.HTTP=c.Granite.HTTP||{};var d=null;c.Granite.HTTP.externalize=c.Granite.HTTP.externalize||function(g){if(null===d)a:{var h=/^(?:http|https):\/\/[^\/]+(\/.*)\/(?:etc\.clientlibs|etc(\/.*)*\/clientlibs|libs(\/.*)*\/clientlibs|apps(\/.*)*\/clientlibs|etc\/designs).*\.js(\?.*)?$/;try{if(c.CQURLInfo)d=CQURLInfo.contextPath||"";else{for(var l=document.getElementsByTagName("script"),k=0;k<l.length;k++){var m=h.exec(l[k].src);if(m){d=m[1];break a}}d=""}}catch(p){}}try{0===
g.indexOf("/")&&d&&0!==g.indexOf(d+"/")&&(g=d+g)}catch(p){}return g}})(this);
(function(c){function q(){this._handler=[]}function d(a){var b="//"+document.location.host,e=document.location.protocol+b;return a===e||a.slice(0,e.length+1)===e+"/"||a===b||a.slice(0,b.length+1)===b+"/"||!/^(\/\/|http:|https:).*/.test(a)}function g(a){c.console&&console.warn("CSRF data not available;The data may be unavailable by design, such as during non-authenticated requests: "+a)}function h(){var a=new q;r=a;var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===b.readyState)try{f=
JSON.parse(b.responseText).token,a.resolve(f)}catch(e){g(e),a.reject(b.responseText)}};b.open("GET",p,!0);b.send();return a}function l(){var a=new XMLHttpRequest;a.open("GET",p,!1);a.send();try{return f=JSON.parse(a.responseText).token}catch(b){g(b)}}function k(a){var b=a.getAttribute("action");"GET"===a.method.toUpperCase()||b&&!d(b)||(f||l(),f&&(b=a.querySelector('input[name\x3d":cq_csrf_token"]'),b||(b=document.createElement("input"),b.setAttribute("type","hidden"),b.setAttribute("name",":cq_csrf_token"),
a.appendChild(b)),b.setAttribute("value",f)))}function m(a){var b=function(a){a=a.target;"FORM"===a.nodeName&&k(a)};a.addEventListener?a.addEventListener("submit",b,!0):a.attachEvent&&a.attachEvent("submit",b)}c.Granite=c.Granite||{};if(!c.Granite.csrf){c.Granite.csrf={initialised:!1,refreshToken:h,_clearToken:function(){f=void 0;h()}};q.prototype={then:function(a,b){this._handler.push({resolve:a,reject:b})},resolve:function(){this._execute("resolve",arguments)},reject:function(){this._execute("reject",
arguments)},_execute:function(a,b){if(null===this._handler)throw Error("Promise already completed.");for(var e=0,d=this._handler.length;e<d;e++)this._handler[e][a].apply(c,b);this.then=function(d,e){("resolve"===a?d:e).apply(c,b)};this._handler=null}};var p=Granite.HTTP.externalize("/libs/granite/csrf/token.json"),r,f;h();m(document);var t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(a,b,c){d(b)&&"get"!==a.toLowerCase()&&(this._csrf=!0,this._async=c);return t.apply(this,arguments)};
var n=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){if(this._csrf)if(f)this.setRequestHeader("CSRF-Token",f),n.apply(this,arguments);else if(!1===this._async)l(),f&&this.setRequestHeader("CSRF-Token",f),n.apply(this,arguments);else{var a=this,b=Array.prototype.slice.call(arguments);r.then(function(c){a.setRequestHeader("CSRF-Token",c);n.apply(a,b)},function(){n.apply(a,b)})}else n.apply(this,arguments)};var u=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=
function(){k(this);return u.apply(this,arguments)};if(c.Node){var v=Node.prototype.appendChild;Node.prototype.appendChild=function(){var a=v.apply(this,arguments);if("IFRAME"===a.nodeName)try{a.contentWindow&&!a._csrf&&(a._csrf=!0,m(a.contentWindow.document))}catch(b){a.src&&a.src.length&&d(a.src)&&c.console&&console.error("Unable to attach CSRF token to an iframe element on the same origin")}return a}}setInterval(function(){h()},3E5)}})(window);